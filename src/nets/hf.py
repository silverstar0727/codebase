import torch
import torch.nn as nn
import torch.nn.functional as F
from transformers import AutoModel, AutoImageProcessor, AutoModelForImageClassification
from typing import Optional, Union
import timm

class HFNetwork(nn.Module):
    """가장 단순한 형태의 SigLIP 분류기"""
    
    def __init__(self, model_name: str):
        super().__init__()
        self.labels = ['1시리즈_F20_2013_2015', '1시리즈_F20_2016_2019', '1시리즈_F40_2020_2024', '2008_2015_2017', '2시리즈_그란쿠페_F44_2020_2024', '2시리즈_액티브_투어러_F45_2019_2021', '2시리즈_액티브_투어러_U06_2022_2024', '3008_2세대_2018_2023', '3시리즈_E90_2005_2012', '3시리즈_F30_2013_2018', '3시리즈_G20_2019_2022', '3시리즈_G20_2023_2025', '3시리즈_GT_F34_2014_2021', '4시리즈_F32_2014_2020', '4시리즈_G22_2021_2023', '4시리즈_G22_2024_2025', '5008_2세대_2018_2019', '5008_2세대_2021_2024', '5시리즈_F10_2010_2016', '5시리즈_G30_2017_2023', '5시리즈_G60_2024_2025', '5시리즈_GT_F07_2010_2017', '6시리즈_F12_2011_2018', '6시리즈_GT_G32_2018_2020', '6시리즈_GT_G32_2021_2024', '718_박스터_2017_2024', '718_카이맨_2017_2024', '7시리즈_F01_2009_2015', '7시리즈_G11_2016_2018', '7시리즈_G11_2019_2022', '7시리즈_G70_2023_2025', '8시리즈_G15_2020_2024', '911_2003_2019', '911_992_2020_2024', 'A4_B9_2016_2019', 'A4_B9_2020_2024', 'A5_F5_2019_2024', 'A6_C8_2019_2025', 'A7_2012_2016', 'A7_4K_2020_2024', 'A8_D5_2018_2023', 'AMG_GT_2016_2024', 'A_클래스_W176_2015_2018', 'A_클래스_W177_2020_2025', 'All_New_XJ_2016_2019', 'B_클래스_W246_2013_2018', 'CLA_클래스_C117_2014_2019', 'CLA_클래스_C118_2020_2025', 'CLE_클래스_C236_2024_2025', 'CLS_클래스_C257_2019_2023', 'CLS_클래스_W218_2012_2017', 'CT6_2016_2018', 'C_클래스_W204_2008_2015', 'C_클래스_W205_2015_2021', 'C_클래스_W206_2022_2024', 'EQ900_2016_2018', 'EQA_H243_2021_2024', 'EQE_V295_2022_2024', 'EQS_V297_2022_2023', 'ES300h_7세대_2019_2026', 'EV6_2022_2024', 'EV9_2024_2025', 'E_PACE_2018_2020', 'E_클래스_W212_2010_2016', 'E_클래스_W213_2017_2020', 'E_클래스_W213_2021_2023', 'E_클래스_W214_2024_2025', 'F150_2004_2021', 'F_PACE_2017_2019', 'G4_렉스턴_2018_2020', 'G70_2018_2020', 'G80_2017_2020', 'G80_RG3_2021_2023', 'G80_RG3_2025', 'G90_2019_2022', 'G90_RS4_2022_2025', 'GLA_클래스_H247_2020_2025', 'GLA_클래스_X156_2015_2019', 'GLB_클래스_X247_2020_2023', 'GLC_클래스_X253_2017_2019', 'GLC_클래스_X253_2020_2022', 'GLC_클래스_X253_2023', 'GLC_클래스_X254_2023_2025', 'GLE_클래스_W166_2016_2018', 'GLE_클래스_W167_2019_2024', 'GLS_클래스_X166_2017_2019', 'GLS_클래스_X167_2020_2024', 'GV70_2021_2023', 'GV80_2020_2022', 'GV80_2024_2025', 'G_클래스_W463_2009_2017', 'G_클래스_W463b_2019_2025', 'K3_2013_2015', 'K5_2세대_2016_2018', 'K5_3세대_2020_2023', 'K5_3세대_하이브리드_2020_2022', 'K5_하이브리드_3세대_2020_2023', 'K7_프리미어_2020_2021', 'K7_프리미어_하이브리드_2020_2021', 'K8_2022_2024', 'K8_하이브리드_2022_2024', 'LF_쏘나타_2015_2017', 'M2_F87_2016_2021', 'M4_F82_2015_2020', 'M5_F90_2018_2023', 'MKC_2015_2018', 'New_XF_2012_2015', 'Q30_2017_2019', 'Q3_F3_2020_2024', 'Q50_2014_2017', 'Q5_FY_2020', 'Q5_FY_2021_2024', 'Q7_4M_2016_2019', 'Q7_4M_2020_2023', 'Q8_4M_2020_2025', 'QM3_2014_2017', 'QM6_2017_2019', 'QX60_2016_2018', 'RAV4_2016_2018', 'RAV4_5세대_2019_2024', 'S60_3세대_2020_2024', 'S90_2017_2020', 'S90_2021_2025', 'SM3_네오_2015_2019', 'SM5_노바_2015_2019', 'SM6_2016_2020', 'SM7_노바_2015_2019', 'SM7_뉴아트_2008_2011', 'S_클래스_W221_2006_2013', 'S_클래스_W222_2014_2020', 'S_클래스_W223_2021_2025', 'UX250h_2019_2024', 'V40_2015_2018', 'V60_크로스컨트리_2세대_2020_2025', 'V90_크로스컨트리_2018_2024', 'X1_F48_2016_2019', 'X1_F48_2020_2022', 'X1_U11_2023_2024', 'X2_F39_2018_2023', 'X3_G01_2018_2021', 'X3_G01_2022_2024', 'X4_F26_2015_2018', 'X4_G02_2019_2021', 'X4_G02_2022_2025', 'X5_F15_2014_2018', 'X5_G05_2019_2023', 'X5_G05_2024_2025', 'X6_F16_2015_2019', 'X6_G06_2020_2023', 'X6_G06_2024_2025', 'X7_G07_2019_2022', 'X7_G07_2023_2025', 'XC40_2019_2022', 'XC60_2세대_2018_2021', 'XC60_2세대_2022_2025', 'XC90_2세대_2017_2019', 'XC90_2세대_2020_2025', 'XE_2016_2019', 'XF_X260_2016_2020', 'XJ_8세대_2010_2019', 'XM3_2020_2023', 'XM3_2024', 'YF쏘나타_2009_2012', 'YF쏘나타_하이브리드_2011_2015', 'Z4_G29_2019_2025', 'e_트론_2020_2023', 'i30_PD_2017_2018', 'i4_2022_2024', 'iX_2022_2024', '골프_7세대_2013_2016', '그랑_콜레오스_2025', '그랜드_스타렉스_2016_2018', '그랜드_체로키_2014_2020', '그랜드_체로키_WL_2021_2023', '그랜드카니발_2006_2010', '그랜저TG_2007_2008', '그랜저_GN7_2023_2025', '그랜저_HG_2011_2014', '그랜저_HG_2015_2017', '그랜저_IG_2017_2019', '글래디에이터_JT_2020_2023', '기블리_2014_2023', '넥쏘_2018_2024', '뉴QM3_2018_2019', '뉴_A6_2012_2014', '뉴_A6_2015_2018', '뉴_CC_2012_2016', '뉴_ES300h_2013_2015', '뉴_ES300h_2016_2018', '뉴_G80_2025_2026', '뉴_GV80_2024_2025', '뉴_MKZ_2017_2020', '뉴_QM5_2012_2014', '뉴_QM6_2021_2023', '뉴_SM5_임프레션_2008_2010', '뉴_SM5_플래티넘_2013_2014', '뉴_스타일_코란도_C_2017_2019', '뉴_제타_2011_2016', '뉴_체어맨_W_2012_2016', '뉴_카이엔_2011_2018', '뉴_티구안_2012_2016', '뉴쏘렌토_R_2013_2014', '니로_2017_2019', '더_K9_2019_2021', '더_기아_레이_EV_2024_2025', '더_넥스트_스파크_2016_2018', '더_뉴_G70_2021_2025', '더_뉴_K3_2016_2018', '더_뉴_K3_2세대_2022_2024', '더_뉴_K5_2세대_2019_2020', '더_뉴_K5_3세대_2024_2025', '더_뉴_K5_하이브리드_3세대_2023_2025', '더_뉴_K7_2013_2016', '더_뉴_K9_2세대_2022_2025', '더_뉴_QM6_2020_2023', '더_뉴_QM6_2024_2025', '더_뉴_SM6_2021_2024', '더_뉴_그랜드_스타렉스_2018_2021', '더_뉴_그랜저_IG_2020_2023', '더_뉴_기아_레이_2022_2025', '더_뉴_니로_2020_2022', '더_뉴_레이_2018_2022', '더_뉴_렉스턴_스포츠_2021_2025', '더_뉴_렉스턴_스포츠_칸_2021_2025', '더_뉴_말리부_2019_2022', '더_뉴_맥스크루즈_2016_2018', '더_뉴_모닝_2015_2016', '더_뉴_모닝_JA_2024_2025', '더_뉴_모하비_2017_2019', '더_뉴_셀토스_2023_2025', '더_뉴_스파크_2019_2022', '더_뉴_싼타페_2021_2023', '더_뉴_쏘렌토_2018_2020', '더_뉴_쏘렌토_4세대_2024_2025', '더_뉴_아반떼_2014_2016', '더_뉴_아반떼_AD_2019_2020', '더_뉴_아반떼_CN7_2023_2025', '더_뉴_아이오닉_하이브리드_2020', '더_뉴_카니발_2019_2020', '더_뉴_카니발_4세대_2024_2025', '더_뉴_코나_2021_2023', '더_뉴_코란도_스포츠_2016_2018', '더_뉴_투싼_NX4_2023_2025', '더_뉴_트랙스_2017_2022', '더_뉴_파사트_2012_2019', '더_뉴_팰리세이드_2023_2024', '더_뉴스포티지R_2014_2016', '더_올뉴G80_2021_2024', '더_올뉴투싼_하이브리드_2021_2023', '디_올_뉴_니로_2022_2025', '디_올_뉴_스포티지_2022_2024', '디_올뉴그랜저_2023_2025', '디_올뉴니로EV_2023_2024', '디_올뉴니로_2022_2025', '디_올뉴싼타페_2024_2025', '디_올뉴코나_2023_2025', '디스커버리_4_2010_2016', '디스커버리_5_2017_2020', '디스커버리_5_2022_2024', '디스커버리_스포츠_2015_2019', '디스커버리_스포츠_2세대_2020_2025', '디펜더_L663_2020_2025', '라브4_4세대_2013_2018', '라브4_5세대_2019_2024', '랭글러_JK_2009_2017', '랭글러_JL_2018_2024', '레니게이드_2015_2017', '레니게이드_2019_2023', '레이_2012_2017', '레인지로버_4세대_2014_2017', '레인지로버_4세대_2018_2022', '레인지로버_5세대_2023_2024', '레인지로버_벨라_2018_2019', '레인지로버_스포츠_2세대_2013_2017', '레인지로버_스포츠_2세대_2018_2022', '레인지로버_이보크_2016_2019', '레인지로버_이보크_2세대_2020_2022', '레인지로버_이보크_2세대_2023_2024', '렉스턴_스포츠_2018_2021', '렉스턴_스포츠_칸_2019_2020', '르반떼_2017_2022', '리얼_뉴_콜로라도_2021_2022', '마칸_2014_2018', '마칸_2019_2021', '마칸_2022_2024', '말리부_2012_2016', '머스탱_2015_2023', '모닝_어반_JA_2021_2023', '모델_3_2019_2022', '모델_3_2024_2025', '모델_Y_2021_2025', '모하비_더_마스터_2020_2024', '몬데오_4세대_2015_2020', '박스터_718_2017_2024', '베뉴_2020_2024', '베리_뉴_티볼리_2020_2023', '벨로스터_JS_2018_2020', '뷰티풀_코란도_2019_2024', '셀토스_2020_2023', '스타리아_2022_2025', '스토닉_2018_2020', '스팅어_2018_2020', '스팅어_마이스터_2021_2023', '스파크_2012_2015', '스포티지_4세대_2016_2018', '스포티지_5세대_2022_2024', '스포티지_더_볼드_2019_2022', '시에나_4세대_2021_2024', '싼타페_MX5_2024_2025', '싼타페_TM_2019_2020', '싼타페_더_프라임_2016_2018', '쏘나타_DN8_2020_2023', '쏘나타_뉴_라이즈_2018_2019', '쏘나타_디_엣지_DN8_2024_2025', '쏘렌토_4세대_2021_2023', '아반떼_AD_2016_2018', '아반떼_CN7_2021_2023', '아반떼_MD_2011_2014', '아반떼_N_2022_2023', '아반떼_하이브리드_CN7_2021_2023', '아베오_2012_2016', '아슬란_2015_2018', '아이오닉5_2022_2023', '아이오닉6_2023_2025', '아이오닉_하이브리드_2016_2019', '아테온_2018_2023', '알티마_2017_2018', '액티언_2세대_2025', '어코드_10세대_2018_2022', '에비에이터_2세대_2020_2025', '에스컬레이드_2015_2020', '에스컬레이드_5세대_2021_2024', '에쿠스_신형_2010_2015', '엑센트_신형_2011_2019', '올_뉴_K3_2019_2021', '올_뉴_K7_2016_2019', '올_뉴_K7_하이브리드_2017_2019', '올_뉴_렉스턴_2021_2025', '올_뉴_말리부_2017_2018', '올_뉴_모닝_2012_2015', '올_뉴_모닝_JA_2017_2020', '올_뉴_쏘렌토_2015_2017', '올_뉴_카니발_2015_2019', '올_뉴_카마로_2017_2018', '올_뉴_투싼_TL_2016_2018', '올_뉴_투싼_TL_2019_2020', '올란도_2012_2018', '익스플로러_2016_2017', '익스플로러_2018_2019', '익스플로러_6세대_2020_2025', '일렉트리파이드_GV70_2022_2024', '임팔라_2016_2019', '제네시스_DH_2014_2016', '체로키_KL_2019_2023', '카니발_4세대_2021', '카니발_4세대_2022_2023', '카이엔_PO536_2019_2023', '캐스퍼_2022_2024', '캠리_XV70_2018_2024', '컨티넨탈_10세대_2017_2019', '컨티넨탈_GT_2세대_2012_2017', '컨티넨탈_GT_3세대_2018_2023', '컴패스_2세대_2018_2022', '코나_2018_2020', '코나_SX2_2023_2025', '코세어_2020_2022', '콜로라도_2020_2020', '콰트로포르테_2014_2016', '콰트로포르테_2017_2022', '쿠퍼_컨버터블_2016_2024', '쿠퍼_컨트리맨_2012_2015', '쿠퍼_컨트리맨_2016_2024', '쿠퍼_클럽맨_2016_2024', '타이칸_2021_2025', '토레스_2023_2025', '투싼_NX4_2021_2023', '투아렉_3세대_2020_2023', '트래버스_2020_2023', '트랙스_2013_2016', '트랙스_크로스오버_2024_2025', '트레일블레이저_2021_2022', '트레일블레이저_2023', '티구안_올스페이스_2018_2023', '티볼리_2015_2018', '티볼리_아머_2018_2019', '티볼리_에어_2016_2019', '티볼리_에어_2021_2022', '파나메라_2010_2016', '파나메라_971_2017_2023', '파사트_GT_B8_2018_2022', '파일럿_3세대_2016_2018', '팰리세이드_2019_2022', '팰리세이드_LX3_2025', '프리우스_4세대_2016_2018', '프리우스_4세대_2019_2022', '프리우스_C_2018_2020']
        self.num_classes = len(self.labels)
        
        self.model = AutoModelForImageClassification.from_pretrained(
            model_name,
            num_labels=len(self.labels),
            id2label={str(i): c for i, c in enumerate(self.labels)},
            label2id={c: str(i) for i, c in enumerate(self.labels)},
            ignore_mismatched_sizes=True,
        )
    
    def forward(self, pixel_values: torch.Tensor) -> torch.Tensor:
        return self.model(pixel_values=pixel_values).logits

